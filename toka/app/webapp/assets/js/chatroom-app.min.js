"use strict";function ChatroomApp(){this.ini=function(t){var o=this;var t=new Chatroom(t);t.iniChatroom();toka.currentChatroom=t;toka.chatrooms[t.chatroomId]=t;toka.tokabot.options["focused"]=true;$(window).focus(function(){toka.tokabot.options["focused"]=true}).blur(function(){toka.tokabot.options["focused"]=false});$("#update-chatroom-btn").off("click").on("click",function(){var t=toka.currentChatroom;t.chatroomName=$("#update-chatroom-title").val().trim();t.categoryName=$("#update-chatroom-category").val();t.info=$("#update-chatroom-info").val();try{t.tags=$("#update-chatroom-tags-input input").val().replace(/[\s,]+/g,",").split(",");for(var a=0;a<t.tags;a++){t.tags[a]=t.tags[a].toLowerCase()}}catch(e){t.tags=[]}if(o.validateUpdateChatroom(t)){t.update()}});$("#update-chatroom-tags-input input").tagsinput({tagClass:"chatroom-tag label label-info"});$("#chatroom-title-update-chatroom div[data-toggle='tooltip']").tooltip({placement:"bottom"});$(".upload-img-btn").on("click",function(){$("input[data-cloudinary-field='upload-img']:file").trigger("click")});$(".cloudinary-fileupload").bind("cloudinarydone",function(t,o){var a=toka.getCookie("username");if(a===""){toka.promptLogin();return}var e=new Message(toka.currentChatroom.chatroomId,a,"/image "+o.result.public_id+"."+o.result.format,timestamp());toka.tokabot.sendMessage(e);return true});try{toka.socket=io.connect(toka.chata,{secure:true});toka.socket.on("connect",function(){console.log("Connection opened.");$(".chatroom .input-msg").attr("placeholder","Connected. Retrieving history...");toka.socket.emit("join",{chatroomId:toka.currentChatroom.chatroomId,username:toka.getCookie("username")});toka.socket.emit("users",toka.currentChatroom.chatroomId)});toka.socket.on("activeViewerCount",function(t){$(".chatroom-heading .users span").text(t[toka.currentChatroom.chatroomId])});toka.socket.on("users",function(t){if(t.hasOwnProperty(toka.currentChatroom.chatroomId)){$(".chatroom .user-list ul").empty();for(var o=0;o<t[toka.currentChatroom.chatroomId].length;o++){$(".chatroom .user-list ul").append($("<li></li>",{text:t[toka.currentChatroom.chatroomId][o]}))}}});toka.socket.on("history",function(t){$(".chatroom .input-msg").attr("placeholder","Type here to chat. Use / for commands.");if(toka.chatrooms.hasOwnProperty(t.chatroomId)){$(toka.chatrooms[t.chatroomId].selectChatroomList).empty();toka.chatrooms[t.chatroomId].loadHistory(t)}});toka.socket.on("receiveMessage",function(t){if(toka.chatrooms.hasOwnProperty(t.chatroomId)){toka.chatrooms[t.chatroomId].receiveMessage(t)}if(!$(toka.currentChatroom.selectChatroomInputMsg).is(":focus")){toka.newMessages++;toka.setTitle("(1+) Toka")}});toka.socket.on("disconnect",function(){console.log("Connection closed.");$(".chatroom .input-msg").attr("placeholder","Disconnected. Reconnecting...")})}catch(a){console.log("Could not connect to chata!")}};this.alertUpdateChatroom=function(t){var o=$("<div></div>",{id:"update-chatroom-alert-text","class":"alert alert-warning alert-dismissible",text:t}).append($("<button></button>",{type:"button","class":"close","data-dismiss":"alert","aria-label":"Close"}).append($("<span></span>",{"aria-hidden":"true",html:"&times;"})));$("#update-chatroom-alert").empty().append(o)};this.validateUpdateChatroom=function(t){if(t.chatroomName===""){this.alertUpdateChatroom("Please provide a chatroom title.");return false}if(t.chatroomName.trim().length>100){this.alertUpdateChatroom("Please keep chatroom titles limited to 100 characters.");return false}else if(t.categoryName==="0"){this.alertUpdateChatroom("Please select a category.");return false}else if(t.tags.length>5){this.alertUpdateChatroom("Please limit tags to 5.");return false}return true}}