"use strict";function Autocomplete(t,e){this.container=t;this.input=e;this.app;this.active=false;this.startIndex=-1}Autocomplete.prototype.ini=function(){var t=this;t.input.on("keyup",function(e){var o=t.input.val();var a=o.substr(o.length-1,o.length);console.log(a);if(a==="@"){t.active=true}else if(t.active){if(t.startIndex==-1)t.startIndex=o.length-1;var s=o.substr(t.startIndex);console.log("username: "+s);t.getUsernameMatches(s)}})};Autocomplete.prototype.getUsernameMatches=function(t){var e=this;e.app=$("<div></div>",{"class":"autocomplete-username",style:"display: none;"}).append($("<div></div>",{"class":"title",html:'<span>usernames matching:</span><span class="text"></span>'})).append($("<ul></ul>",{"class":"ac-username-list"}));e.container.append(e.app);var o={};$.ajax({url:"/rs/user/search?u="+t,type:"GET",dataType:"json",beforeSend:o.hasOwnProperty("beforeSend")?o["beforeSend"]:function(){},complete:o.hasOwnProperty("complete")?o["complete"]:function(){},success:function(t){if(t["status"]!==200){console.log("Error!!")}else{e.app.show()}}})};"use strict";function CommandHelp(t,e){this.container=t;this.input=e;this.app;this.active;this.autocomplete=true;this.commands={"/define":{options:"[word]",desc:"Define a word"},"/me":{options:"[text]",desc:"Perform an action"},"/spoiler":{options:"[text]",desc:"Hide text in a spoiler block"},"/urban":{options:"[word]",desc:"Find the urban dictionary definition of a word"},"/view":{options:"[room]",desc:"Peek into a room by providing a chatroom id"}}}CommandHelp.prototype.ini=function(){var t=this;t.app=$("<div></div>",{"class":"commands-help",style:"display: none;"}).append($("<div></div>",{"class":"commands-top",html:"<span>Commands</span>"})).append($("<ul></ul>",{"class":"commands-list"}));t.container.append(t.app);for(var e in t.commands){if(t.commands.hasOwnProperty(e)){t.app.find(".commands-list").append($("<li></li>",{html:'<span class="command">'+e+' </span><span class="command-options">'+t.commands[e].options+'</span><span class="command-desc">'+t.commands[e].desc+"</span>"}))}}t.app.find(".commands-list li:first").addClass("selected");t.app.find("li").on("click",function(){t.loadCommand($(this))});t.input.on("keyup",function(e){var o=t.input.val();if(o==="/"){t.app.show();t.active=true;$(t.input).addClass("commandActive");$(t.app).css("bottom",$(t.input).outerHeight())}else if(o==""){t.hide()}if(t.active){if(e.which==27){t.hide();return}else if(t.active&&e.which==38){var a=t.app.find("li.selected");if(a.prev().length){a.removeClass("selected");a.prev().addClass("selected")}return}else if(e.which==40){var a=t.app.find("li.selected");if(a.next().length){a.removeClass("selected");a.next().addClass("selected")}return}else if(e.which==13){var a=t.app.find("li.visible.selected");if(a.length!=0){e.preventDefault();t.loadCommand(a)}return}t.app.find("li").filter(function(){$(this).show();$(this).addClass("visible");$(this).removeClass("selected");var t=$(this).text();if(o!=t.substr(0,o.length)){$(this).hide();$(this).removeClass("visible")}});var a=t.app.find("li.visible:first").addClass("selected");if(a.length==0)t.autocomplete=false;else t.autocomplete=true}})};CommandHelp.prototype.hide=function(){var t=this;$(t.app).hide();t.active=false;$(t.input).removeClass("commandActive")};CommandHelp.prototype.loadCommand=function(t){var e=this;var o=t.find(".command").text();e.input.val(o);e.hide()};CommandHelp.prototype.sendReady=function(){var t=this;return!t.active||t.active&&!t.autocomplete};"use strict";function timestamp(t){if(typeof t==="undefined")return moment().format("MMM D, YYYY h:mma");else{t=moment.utc(t,"MMM D, YYYY h:mma");return moment(t.toDate()).format("MMM D, YYYY h:mma")}}function timediff(){time=moment.utc(time,"MMM D, YYYY h:mma");var t=moment.utc(moment().utc().format("MMM D, YYYY h:mm a"),"MMM D, YYYY h:mma");var e=moment.duration(t.diff(time)).asHours();var o=moment.duration(t.diff(time)).asMinutes();var a=moment.duration(t.diff(time)).asSeconds();if(e>6){return moment(time.toDate()).format("MMM D, YYYY h:mma")}else if(e>1){return moment(time.toDate()).format("MMM D, YYYY h:mma")+" || "+parseInt(e,10)+" hours ago"}else if(e==1){return moment(time.toDate()).format("MMM D, YYYY h:mma")+" || "+parseInt(e,10)+" hour ago"}else if(o>1){return moment(time.toDate()).format("MMM D, YYYY h:mma")+" || "+parseInt(o,10)+" minutes ago"}else if(o==1){return moment(time.toDate()).format("MMM D, YYYY h:mma")+" || "+parseInt(o,10)+" minute ago"}else{return moment(time.toDate()).format("MMM D, YYYY h:mma")+" || "+parseInt(a,10)+" seconds ago"}}var toka={};function Toka(){this.chata="https://toka.io:1337";this.socket;this.categoryList=[];this.chatrooms={};this.currentChatroom={};this.newMessages=0;this.sortedChatroomList=false;this.tokabot;this.ini=function(){var t=this;var e=new LeftNavApp;t.adjustSiteContentHeight();$(window).off("resize").on("resize",function(){t.adjustSiteContentHeight()});$("#search-page").off().on("click",function(){t.alert("Search is not available yet.")});e.ini()};this.iniSockets=function(){var t=this;try{t.socket=io.connect(toka.chata,{secure:true});t.socket.on("connect",function(){console.log("Connection opened.")});t.socket.on("disconnect",function(){console.log("Connection closed.")})}catch(e){console.log("Could not connect to chata!")}};this.adjustSiteContentHeight=function(){$("#site-content").css("min-height",$("#site").height()-$("#site-menu").height());$("#site-left-nav").css("min-height",$("#site").height()-$("#site-menu").height())};this.getCookie=function(t){var e=t+"=";var o=document.cookie.split(";");for(var a=0;a<o.length;a++){var s=o[a];while(s.charAt(0)==" ")s=s.substring(1);if(s.indexOf(e)==0)return s.substring(e.length,s.length)}return""};this.promptLogin=function(){$("#login-form").off().on("shown.bs.modal",function(){$("#toka-login-username").focus()});$("#login-form").modal("show")};this.resetTitle=function(){var t=$("title");t.text("Toka")};this.setChatrooms=function(t){var e=this;for(var o in t){e.chatrooms[o]=new Chatroom(t[o])}};this.setTitle=function(t){var e=$("title");e.text(t)}}function LeftNavApp(){this.ini=function(){$("#profile").on("click",function(){if($("#profile-menu").hasClass("open")){$("#profile-menu").slideUp(500);$("#profile-menu").removeClass("open").addClass("closed");$("#profile-img").attr("src","/assets/images/icons/add.svg")}else{$("#profile-menu").slideDown(500);$("#profile-menu").removeClass("closed").addClass("open");$("#profile-img").attr("src","/assets/images/icons/minus.svg")}});$("#chatfeed-btn").off("click").on("click",function(){var t=$("#chatfeed iframe").attr("src");console.log(t);if(t=="about:blank")$("#chatfeed iframe").attr("src","/chatroom/"+toka.getCookie("username")+"?embed=1&target=_blank");$("#chatfeed").modal("show")})}}function Chatroom(t){this.newMessages=0;this.lastSender="";this.autoScroll=true;this.banned=t["banned"];this.categoryName=t["categoryName"];this.chatroomId=t["chatroomId"];this.chatroomName=t["chatroomName"];this.chatroomType=t["chatroomType"];this.coOwner=t["coOwner"];this.guesting=t["guesting"];this.info=t["info"];this.maxSize=t["maxSize"];this.mods=t["mods"];this.owner=t["owner"];this.tags=t["tags"];this.groupMessageFlag="n";this.commandsHelpActive=false;this.selectChatroomItem=".chatroom-item[data-chatroom-id='"+this.chatroomId+"']";this.selectChatroomItemTopContainer=this.selectChatroomItem+" .chatroom-item-top";this.selectChatroomItemUserCount=this.selectChatroomItem+" .chatroom-item-bottom .chatroom-item-users-count";this.selectChatroom=".chatroom[data-chatroom-id='"+this.chatroomId+"']";this.selectChatroomList=this.selectChatroom+" .messages";this.selectChatroomBody=this.selectChatroom+" .messages-container";this.selectChatroomChatBox=this.selectChatroom+" .chatbox";this.selectChatroomInfoBox=this.selectChatroom+" .infobox";this.selectChatroomInputMsg=this.selectChatroom+" .inputbox .input-msg";this.selectChatroomTitleMenuUser=this.selectChatroom+" .title-menu .users";this.selectChatroomUserList=this.selectChatroom+" .user-list";this.commandHelp=new CommandHelp($(this.selectChatroomChatBox),$(this.selectChatroomInputMsg));this.autocomplete=new Autocomplete($(this.selectChatroom),$(this.selectChatroomInputMsg))}Chatroom.prototype.iniChatroom=function(){var t=this;$(t.selectChatroomBody).height(t.getHeight());$(window).on("resize",function(){$(t.selectChatroomBody).height(t.getHeight())});$(window).on("focus",function(){toka.newMessages=0;toka.setTitle(t.chatroomName+" - Toka")});$(t.selectChatroomInputMsg).off("click").on("click",function(){toka.newMessages=0;toka.setTitle(t.chatroomName+" - Toka")});$(t.selectChatroomInputMsg).off("keydown").on("keydown",function(e){toka.newMessages=0;toka.setTitle(t.chatroomName+" - Toka");if(t.commandHelp.sendReady()&&e.which===13){if(!e.shiftKey){e.preventDefault();t.sendMessage();$(t.selectChatroomInputMsg).attr("rows",1);$(t.selectChatroomBody).height(t.getHeight())}else{var o=parseInt($(t.selectChatroomInputMsg).attr("rows"));if(o<4){$(t.selectChatroomInputMsg).attr("rows",o+1);$(t.selectChatroomBody).height(t.getHeight())}}}});t.commandHelp.ini();t.autocomplete.ini();$(t.selectChatroomTitleMenuUser).off().on({mouseenter:function(){toka.socket.emit("users",toka.currentChatroom.chatroomId);var e=$(this).offset();var o=$(t.selectChatroomUserList);o.width("auto");var a=o.width();o.width(a);o.show().offset({top:e.top,left:e.left-a})},mouseleave:function(){$(t.selectChatroomUserList).hide()}});$(t.selectChatroomBody).mCustomScrollbar({theme:"dark",alwaysShowScrollbar:1,mouseWheel:{scrollAmount:240,normalizeDelta:true},callbacks:{whileScrolling:function(){t.autoScroll=false;if(this.mcs.topPct>=99.5)t.autoScroll=true}}});$(t.selectChatroomInfoBox).mCustomScrollbar({alwaysShowScrollbar:0,mouseWheel:{scrollAmount:120}})};Chatroom.prototype.getHeight=function(){return $("#site").height()-$("#site-menu").height()-$(".chatroom-heading").outerHeight(true)-$(".inputbox").outerHeight()};Chatroom.prototype.loadHistory=function(t){toka.tokabot.loadHistory(t)};Chatroom.prototype.receiveMessage=function(t){var e=this;var o=$(e.selectChatroomList);var a=toka.getCookie("username");t.timestamp=timestamp(t.timestamp);toka.tokabot.receiveMessage(t)};Chatroom.prototype.scrollChatToBottom=function(){var t=this;$(t.selectChatroomBody).mCustomScrollbar("update");$(t.selectChatroomBody).mCustomScrollbar("scrollTo","bottom",{scrollInertia:0})};Chatroom.prototype.sendMessage=function(){var t=this;var e=toka.getCookie("username");if(e===""){toka.promptLogin();return}var o=$(t.selectChatroomInputMsg).val();var a=new Message(t.chatroomId,e,o,timestamp());if(o.trim()==="")return;$(t.selectChatroomInputMsg).val("");toka.tokabot.sendMessage(a)};Chatroom.prototype.update=function(){var t=this;var e=toka.getCookie("username");if(e===""){toka.alert("Cannot update chatroom! Please log in.");return}var o={};o["chatroomId"]=t.chatroomId;o["categoryName"]=t.categoryName;o["chatroomName"]=t.chatroomName;o["info"]=t.info;o["tags"]=t.tags;var a={beforeSend:function(){$("#update-chatroom-loader").show()},complete:function(){$("#update-chatroom-loader").hide()}};$.ajax({url:"/chatroom/"+t.chatroomId+"/update",type:"POST",data:o,dataType:"json",beforeSend:a.hasOwnProperty("beforeSend")?a["beforeSend"]:function(){},complete:a.hasOwnProperty("complete")?a["complete"]:function(){},success:function(e){if(e["status"]!==200){var o=e["message"];o=o.charAt(0).toUpperCase()+o.slice(1);t.alertUpdateChatroom("Server Error: "+o)}else{window.location.href="/chatroom/"+e["chatroomId"]}}})};Chatroom.prototype.updateChatroomItemUsers=function(t){var e=this;$(e.selectChatroomItemUserCount).text(t)};function Message(t,e,o,a){this.chatroomId=t;this.username=e;this.text=o;this.timestamp=a}var banned_list={bitch:1,dick:1,fuck:1,motherfucker:1,penis:1,shit:1,vagina:1,wanker:1,god:1,jesus:1,christ:1,satan:1};var reserved_list={google:1,facebook:1,linkedin:1,microsoft:1,twitter:1,support:1,tokaadmin:1,toka_admin:1,tokahelp:1,toka_help:1,tokasupport:1,toka_support:1,tokabot:1,toka_bot:1};