"use strict";function ChatroomApp(){this.ini=function(t){var o=this,t=new Chatroom(t);t.iniChatroom(),toka.currentChatroom=t,toka.chatrooms[t.chatroomId]=t,toka.tokabot.options.focused=!0,$(window).focus(function(){toka.tokabot.options.focused=!0}).blur(function(){toka.tokabot.options.focused=!1}),$("#update-chatroom-btn").off("click").on("click",function(){var t=toka.currentChatroom;t.chatroomName=$("#update-chatroom-title").val().trim(),t.categoryName=$("#update-chatroom-category").val(),t.info=$("#update-chatroom-info").val();try{t.tags=$("#update-chatroom-tags-input input").val().replace(/[\s,]+/g,",").split(",");for(var a=0;a<t.tags;a++)t.tags[a]=t.tags[a].toLowerCase()}catch(e){t.tags=[]}o.validateUpdateChatroom(t)&&t.update()}),$("#update-chatroom-tags-input input").tagsinput({tagClass:"chatroom-tag label label-info"}),$("#chatroom-title-update-chatroom div[data-toggle='tooltip']").tooltip({placement:"bottom"}),$(".upload-img-btn").on("click",function(){$("input[data-cloudinary-field='upload-img']:file").trigger("click")}),$(".cloudinary-fileupload").bind("cloudinarydone",function(t,o){var a=toka.getCookie("username");if(""===a)return void toka.promptLogin();var e=new Message(toka.currentChatroom.chatroomId,a,"/image "+o.result.public_id+"."+o.result.format,timestamp());return toka.tokabot.sendMessage(e),!0});try{toka.socket=io.connect(toka.chata,{secure:!0}),toka.socket.on("connect",function(){console.log("Connection opened."),$(".chatroom .input-msg").attr("placeholder","Connected. Retrieving history..."),toka.socket.emit("join",{chatroomId:toka.currentChatroom.chatroomId,username:toka.getCookie("username")}),toka.socket.emit("users",toka.currentChatroom.chatroomId)}),toka.socket.on("activeViewerCount",function(t){$(".chatroom-heading .users span").text(t[toka.currentChatroom.chatroomId])}),toka.socket.on("users",function(t){var o=toka.currentChatroom.chatroomId;if(t.hasOwnProperty(o)){for(var a=0;a<t[o].length;a++)toka.tokabot.registerNewUserTheme(t[o][a],a);$(".chatroom .user-list ul").empty();for(var a=0;a<t[toka.currentChatroom.chatroomId].length;a++)$(".chatroom .user-list ul").append($("<li></li>",{text:t[toka.currentChatroom.chatroomId][a]}))}}),toka.socket.on("history",function(t){$(".chatroom .input-msg").attr("placeholder","Type here to chat. Use / for commands."),toka.chatrooms.hasOwnProperty(t.chatroomId)&&($(toka.chatrooms[t.chatroomId].selectChatroomList).empty(),toka.chatrooms[t.chatroomId].loadHistory(t))}),toka.socket.on("receiveMessage",function(t){toka.chatrooms.hasOwnProperty(t.chatroomId)&&toka.chatrooms[t.chatroomId].receiveMessage(t),$(toka.currentChatroom.selectChatroomInputMsg).is(":focus")||(toka.newMessages++,toka.setTitle("(1+) Toka"))}),toka.socket.on("disconnect",function(){console.log("Connection closed."),$(".chatroom .input-msg").attr("placeholder","Disconnected. Reconnecting...")})}catch(a){console.log("Could not connect to chata!")}},this.alertUpdateChatroom=function(t){var o=$("<div></div>",{id:"update-chatroom-alert-text","class":"alert alert-warning alert-dismissible",text:t}).append($("<button></button>",{type:"button","class":"close","data-dismiss":"alert","aria-label":"Close"}).append($("<span></span>",{"aria-hidden":"true",html:"&times;"})));$("#update-chatroom-alert").empty().append(o)},this.validateUpdateChatroom=function(t){return""===t.chatroomName?(this.alertUpdateChatroom("Please provide a chatroom title."),!1):t.chatroomName.trim().length>100?(this.alertUpdateChatroom("Please keep chatroom titles limited to 100 characters."),!1):"0"===t.categoryName?(this.alertUpdateChatroom("Please select a category."),!1):t.tags.length>5?(this.alertUpdateChatroom("Please limit tags to 5."),!1):!0}}